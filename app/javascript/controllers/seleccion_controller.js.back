import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  static targets = ["lista"]

  agregar(event) {
    const boton = event.currentTarget

    const id = boton.dataset.id
    const cliente = boton.dataset.cliente
    const ot = boton.dataset.ot
    const prod = boton.dataset.prod

    // ğŸŸ¢ Insertar fila en la tabla seleccionada
    this.listaTarget.insertAdjacentHTML("beforeend", `
      <tr data-id="${id}">
        <td>${ot}</td>
        <td>${cliente}</td>
        <td>${prod}</td>
        <td>
          <button class="btn btn-danger btn-sm" data-action="seleccion#quitar" data-id="${id}">
            âŒ Quitar
          </button>
        </td>
      </tr>
    `)

    // ğŸŸ¡ Cambio de texto del botÃ³n
    boton.textContent = "âœ… Ok"

    // ğŸ”’ Deshabilitarlo para que no se pueda volver a agregar
    boton.classList.remove("btn-success")
    boton.classList.add("btn-secondary")
    boton.disabled = true
  }

  quitar(event) {
    const id = event.currentTarget.dataset.id

    // ğŸ”´ Eliminar fila seleccionada
    const fila = this.listaTarget.querySelector(`tr[data-id="${id}"]`)
    if (fila) fila.remove()

    // ğŸŸ¢ Reactivar el botÃ³n original "Agregar"
    const botonOriginal = document.querySelector(`button[data-id='${id}']`)

    if (botonOriginal) {
      botonOriginal.textContent = "â• Agregar"
      botonOriginal.classList.remove("btn-secondary")
      botonOriginal.classList.add("btn-success")
      botonOriginal.disabled = false
    }
  }
}
